<nav>
  <ul class="branch-nav">
  {%- assign current_branch = page.dir -%}
  {%- assign excluded = 'about,feed.xml,404.html' | split: ',' -%}
  {%- assign pages_in_branch = site.pages | where 'ext', 'html' -%}
  {%- for otherPage in pages_in_branch -%}
    {%- assign remainder = otherPage.dir | remove_first: current_branch -%}
    {%- assign segments = remainder | split: '/' -%}

    {{ segments | join: ',' | debug }}

    {%- if segments[1] -%}
      {%- unless segments[2] or excluded contains segments[1] -%}
        <li class="branch-item {% if current_branch == otherPage.dir %}active{% endif %}">
          <a href="{{ otherPage.url | relative_url }}">{{ otherPage.title | default: otherPage.slug }}</a>
        </li>    
      {%- endunless -%}
    {%- endif -%}

  {%- endfor -%}


          {%- for path in page_paths -%}
            {%- assign my_page = site.pages | where: "path", path | first -%}
            {%- if my_page.title -%}
            <a class="page-link" href="{{ my_page.url | relative_url }}">{{ my_page.title | escape }}</a>
            {%- endif -%}
          {%- endfor -%}
  </ul>
</nav>